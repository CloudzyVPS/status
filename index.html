<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Cloudzy Status - Service Status Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="align-ui.css">
    <style>
        /* Light Mode - Dark globe for readability */
        :root[data-theme="light"] {
            --globe-bg: linear-gradient(180deg, #0e121b 0%, #0a1628 100%);
            --globe-glow: radial-gradient(ellipse 100% 60% at 50% 100%, rgba(18, 52, 86, 0.5) 0%, rgba(18, 52, 86, 0.25) 30%, transparent 70%);
            --globe-color: #0A2540;
            --globe-land: #0095ff;
            --globe-atmosphere: #0095ff;
            --globe-marker: #51b1f6;
        }

        /* Dark Mode */
        :root[data-theme="dark"] {
            --globe-bg: linear-gradient(180deg, #0e121b 0%, #080c14 100%);
            --globe-glow: radial-gradient(ellipse 100% 60% at 50% 100%, rgba(14, 18, 27, 1) 25%, rgba(14, 18, 27, 0) 100%, transparent 100%);
            --globe-color: #0A2540;
            --globe-land: #4488CC;
            --globe-atmosphere: #3399FF;
            --globe-marker: #8fd0ff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { scroll-behavior: smooth; }
        
        body { 
            font-family: 'Inter', var(--font-family-base), -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-background);
            color: var(--text-strong);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--bg-white);
            border-bottom: 1px solid var(--stroke-soft);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            z-index: 1000;
            backdrop-filter: blur(12px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-base);
            letter-spacing: -0.5px;
        }

        .logo-divider {
            width: 1px;
            height: 24px;
            background: var(--stroke-soft);
        }

        .logo-status {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-sub);
        }

        .header-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .global-status-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 600;
        }

        .global-status-chip.operational {
            background: var(--state-success-lighter);
            color: var(--state-success-base);
        }

        .global-status-chip .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .header-link {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-sub);
            text-decoration: none;
            transition: color 0.2s;
        }

        .header-link:hover { color: var(--primary-base); }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-10);
            border: 1px solid var(--stroke-soft);
            background: var(--bg-weak);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            border-color: var(--stroke-sub);
            background: var(--bg-white);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: var(--text-sub);
        }

        [data-theme="dark"] .theme-toggle .sun-icon { display: block; }
        [data-theme="dark"] .theme-toggle .moon-icon { display: none; }
        .theme-toggle .sun-icon { display: none; }
        .theme-toggle .moon-icon { display: block; }

        /* Globe Section */
        .globe-section {
            position: relative;
            height: 100vh;
            min-height: 700px;
            background: var(--globe-bg);
            overflow: hidden;
            transition: height 0.4s ease-out, background 0.3s ease;
        }

        .globe-section::before {
            content: '';
            position: absolute;
            bottom: -50%;
            left: 50%;
            transform: translateX(-50%);
            width: 150%;
            height: 100%;
            background: radial-gradient(ellipse 50% 40% at 50% 100%, rgba(0, 149, 255, 0.35) 0%, rgba(51, 92, 255, 0.2) 40%, transparent 70%);
            pointer-events: none;
            z-index: 5;
        }

        .globe-section::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: var(--globe-glow);
            pointer-events: none;
            z-index: 10;
        }

        #globe-container {
            position: absolute;
            top: 64px;
            left: 0;
            right: 0;
            bottom: 0;
        }

        #globe-container canvas {
            cursor: grab;
        }

        #globe-container canvas:active {
            cursor: grabbing;
        }

        #labels-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 150;
        }

        .region-label {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 0.2px;
            text-shadow: 0 2px 12px rgba(0,0,0,0.95), 0 0 30px rgba(0,100,255,0.5);
            white-space: nowrap;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .region-label .flag {
            font-size: 24px;
        }

        .region-label .status-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-left: 2px;
        }

        .region-label .status-indicator.outage {
            background: rgba(251, 55, 72, 0.95);
            animation: status-blink 1s infinite;
        }

        .region-label .status-indicator.degraded {
            background: rgba(246, 181, 30, 0.95);
        }

        .region-label .status-indicator.maintenance {
            background: rgba(51, 130, 246, 0.95);
        }

        .region-label .status-indicator svg {
            width: 14px;
            height: 14px;
            fill: #fff;
        }

        @keyframes status-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #region-tooltip {
            position: fixed;
            background: linear-gradient(135deg, rgba(14, 18, 27, 0.98), rgba(24, 27, 37, 0.95));
            border: 1px solid var(--azure-700);
            border-radius: var(--radius-12);
            padding: 16px 20px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            min-width: 240px;
            box-shadow: 0 12px 40px rgba(0, 100, 255, 0.3), 0 0 0 1px rgba(0, 149, 255, 0.2);
            backdrop-filter: blur(20px);
        }

        #region-tooltip .region-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--azure-400);
            margin-bottom: 14px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 149, 255, 0.25);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #region-tooltip .region-name .flag {
            font-size: 20px;
        }

        #region-tooltip .delay-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #region-tooltip .delay-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #region-tooltip .delay-item .target-name {
            color: rgba(200, 220, 255, 0.9);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #region-tooltip .delay-item .target-name .flag {
            font-size: 16px;
        }

        #region-tooltip .delay-item .delay-value {
            font-weight: 600;
            padding: 3px 10px;
            border-radius: var(--radius-6);
            font-size: 12px;
            font-family: 'Inter', monospace;
        }

        #region-tooltip .delay-item .delay-value.low {
            background: var(--green-alpha-16);
            color: var(--green-400);
        }

        #region-tooltip .delay-item .delay-value.medium {
            background: var(--yellow-alpha-16);
            color: var(--yellow-400);
        }

        #region-tooltip .delay-item .delay-value.high {
            background: var(--red-alpha-16);
            color: var(--red-400);
        }

        .globe-hero-content {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 60;
            pointer-events: none;
        }

        .globe-hero-content h1 {
            font-size: 48px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0px;
            letter-spacing: -2px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.5);
            width: 100%;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 60;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            animation: bounce 2s infinite;
            text-shadow: none;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(8px); }
        }

        .scroll-indicator svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* Main Content */
        .main-content {
            position: relative;
            z-index: 100;
            background: var(--bg-background);
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 32px;
        }

        /* Hero Summary */
        .hero-summary {
            padding: 60px 0;
            text-align: center;
            border-bottom: 1px solid var(--stroke-soft);
        }

        .hero-summary h2 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-strong);
        }

        .hero-summary p {
            font-size: 16px;
            color: var(--text-sub);
            margin-bottom: 24px;
        }

        .status-badge-large {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: var(--radius-full);
            font-size: 16px;
            font-weight: 600;
        }

        .status-badge-large.operational {
            background: var(--state-success-lighter);
            color: var(--state-success-base);
            border: 1px solid var(--state-success-base);
        }

        .status-badge-large .check-icon {
            width: 20px;
            height: 20px;
        }

        .last-updated {
            margin-top: 16px;
            font-size: 13px;
            color: var(--text-soft);
        }

        /* Section Styles */
        .section {
            padding: 60px 0;
            border-bottom: 1px solid var(--stroke-soft);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-strong);
        }

        .section-subtitle {
            font-size: 14px;
            color: var(--text-sub);
            margin-top: 4px;
        }

        /* Region Cards Grid */
        .region-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .region-card {
            background: var(--bg-white);
            border: 1px solid var(--stroke-soft);
            border-radius: var(--radius-12);
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--regular-shadow-xsmall);
        }

        .region-card:hover {
            border-color: var(--primary-base);
            box-shadow: var(--custom-shadow-small);
            transform: translateY(-2px);
        }

        .region-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 12px;
        }

        .region-info h3 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-strong);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .region-code {
            font-size: 11px;
            font-family: 'Inter', monospace;
            color: var(--text-soft);
            background: var(--bg-weak);
            padding: 2px 6px;
            border-radius: var(--radius-4);
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
        }

        .status-pill.operational {
            background: var(--state-success-lighter);
            color: var(--state-success-base);
        }

        .status-pill.degraded {
            background: var(--state-away-lighter);
            color: var(--state-away-base);
        }

        .status-pill.outage {
            background: var(--state-error-lighter);
            color: var(--state-error-base);
        }

        .status-pill.maintenance {
            background: var(--state-information-lighter);
            color: var(--state-information-base);
        }

        .status-pill.unknown {
            background: var(--state-faded-lighter);
            color: var(--state-faded-base);
        }

        .status-pill .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .status-pill .icon {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .region-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-sub);
        }

        .incident-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: var(--radius-6);
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .incident-badge.incident {
            background: var(--state-error-lighter);
            color: var(--state-error-base);
        }

        .incident-badge.maintenance {
            background: var(--state-information-lighter);
            color: var(--state-information-base);
        }

        .incident-badge .badge-icon {
            width: 12px;
            height: 12px;
            fill: currentColor;
        }

        .uptime-bar {
            display: flex;
            gap: 2px;
            margin-top: 16px;
        }

        .uptime-day {
            flex: 1;
            height: 24px;
            border-radius: var(--radius-4);
            background: var(--state-success-base);
            transition: all 0.2s;
        }

        .uptime-day.degraded { background: var(--state-away-base); }
        .uptime-day.outage { background: var(--state-error-base); }
        .uptime-day.maintenance { background: var(--state-information-base); }

        .uptime-day:hover {
            transform: scaleY(1.15);
        }

        /* Latency Table */
        .latency-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        .latency-info h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-strong);
        }

        .latency-info p {
            color: var(--text-sub);
            margin-bottom: 24px;
        }

        .latency-legend {
            display: flex;
            gap: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-sub);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-dot.low { background: var(--state-success-base); }
        .legend-dot.medium { background: var(--state-away-base); }
        .legend-dot.high { background: var(--state-error-base); }

        .latency-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-white);
            border-radius: var(--radius-12);
            overflow: hidden;
            border: 1px solid var(--stroke-soft);
            box-shadow: var(--regular-shadow-xsmall);
        }

        .latency-table th,
        .latency-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--stroke-soft);
        }

        .latency-table th {
            background: var(--bg-weak);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-soft);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .latency-table td {
            font-size: 14px;
            color: var(--text-strong);
        }

        .latency-table tr:last-child td {
            border-bottom: none;
        }

        .latency-value {
            font-family: 'Inter', monospace;
            font-weight: 500;
        }

        .latency-value.low { color: var(--state-success-base); }
        .latency-value.medium { color: var(--state-away-base); }
        .latency-value.high { color: var(--state-error-base); }

        /* Footer */
        .footer {
            padding: 40px 0;
            background: var(--bg-white);
            border-top: 1px solid var(--stroke-soft);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-links {
            display: flex;
            gap: 24px;
        }

        .footer-links a {
            font-size: 14px;
            color: var(--text-sub);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover { color: var(--primary-base); }

        .footer-meta {
            font-size: 13px;
            color: var(--text-soft);
        }

        /* Notifications Section */
        .notify-section {
            background: var(--bg-weak);
            padding: 48px;
            border-radius: var(--radius-16);
            text-align: center;
            margin: 60px 0;
            border: 1px solid var(--stroke-soft);
        }

        .notify-section h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-strong);
        }

        .notify-section p {
            color: var(--text-sub);
            margin-bottom: 24px;
        }

        .notify-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: var(--radius-8);
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--primary-base);
            color: var(--static-white);
            box-shadow: var(--fancy-buttons-primary-shadow);
        }

        .btn-primary:hover {
            background: var(--primary-darker);
        }

        .btn-secondary {
            background: var(--bg-white);
            color: var(--text-strong);
            border: 1px solid var(--stroke-soft);
            box-shadow: var(--regular-shadow-xsmall);
        }

        .btn-secondary:hover {
            border-color: var(--stroke-sub);
            background: var(--bg-weak);
        }

        /* Region Detail Panel */
        .region-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(14, 18, 27, 0.5);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .region-panel-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .region-panel {
            position: fixed;
            top: 0;
            right: -520px;
            width: 520px;
            max-width: 100%;
            height: 100vh;
            background: var(--bg-white);
            border-left: 1px solid var(--stroke-soft);
            z-index: 2001;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: var(--custom-shadow-large);
        }

        .region-panel.active {
            right: 0;
        }

        .panel-header {
            padding: 24px;
            border-bottom: 1px solid var(--stroke-soft);
        }

        .panel-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-title h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-strong);
            margin: 0;
        }

        .panel-title .region-code {
            font-size: 14px;
            color: var(--text-soft);
            font-weight: 400;
        }

        .panel-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-weak);
            border-radius: var(--radius-8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .panel-close:hover {
            background: var(--bg-soft);
        }

        .panel-close svg {
            width: 20px;
            height: 20px;
            fill: var(--text-sub);
        }

        .panel-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--stroke-soft);
        }

        .panel-tab {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-sub);
            background: none;
            border: none;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .panel-tab:hover {
            color: var(--text-strong);
        }

        .panel-tab.active {
            color: var(--primary-base);
        }

        .panel-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-base);
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .panel-section {
            margin-bottom: 24px;
        }

        .panel-section:last-child {
            margin-bottom: 0;
        }

        .panel-alert {
            padding: 12px 16px;
            border-radius: var(--radius-8);
            font-size: 14px;
            margin-bottom: 24px;
        }

        .panel-alert.warning {
            background: var(--state-error-lighter);
            color: var(--state-error-dark);
            border: 1px solid var(--state-error-light);
        }

        .panel-alert.info {
            background: var(--state-success-lighter);
            color: var(--state-success-dark);
            border: 1px solid var(--state-success-light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-weak);
            border: 1px solid var(--stroke-soft);
            border-radius: var(--radius-10);
            padding: 16px;
        }

        .stat-label {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-soft);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-strong);
        }

        .stat-value.success {
            color: var(--state-success-base);
        }

        /* Incident Card */
        .incident-card {
            background: var(--bg-white);
            border: 1px solid var(--stroke-soft);
            border-radius: var(--radius-12);
            padding: 20px;
            margin-bottom: 16px;
        }

        .incident-header {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .incident-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
        }

        .incident-status-badge.investigating {
            background: var(--state-warning-lighter);
            color: var(--state-warning-base);
        }

        .incident-status-badge.identified {
            background: var(--state-information-lighter);
            color: var(--state-information-base);
        }

        .incident-status-badge.monitoring {
            background: var(--state-verified-lighter);
            color: var(--state-verified-base);
        }

        .incident-status-badge.resolved {
            background: var(--state-success-lighter);
            color: var(--state-success-base);
        }

        .severity-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
            background: var(--bg-weak);
            color: var(--text-sub);
            border: 1px solid var(--stroke-soft);
        }

        .severity-badge.critical {
            background: var(--state-error-lighter);
            color: var(--state-error-base);
            border-color: var(--state-error-light);
        }

        .severity-badge.major {
            background: var(--state-warning-lighter);
            color: var(--state-warning-base);
            border-color: var(--state-warning-light);
        }

        .incident-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-strong);
            margin-bottom: 8px;
        }

        .incident-description {
            font-size: 14px;
            color: var(--text-sub);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .incident-meta {
            font-size: 13px;
            color: var(--text-soft);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .incident-meta .ongoing {
            color: var(--state-warning-base);
            font-weight: 500;
        }

        /* Status Updates Timeline */
        .status-updates {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--stroke-soft);
        }

        .status-updates-title {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-soft);
            margin-bottom: 16px;
        }

        .update-item {
            display: flex;
            gap: 12px;
            padding-bottom: 16px;
            position: relative;
        }

        .update-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 5px;
            top: 16px;
            bottom: 0;
            width: 2px;
            background: var(--stroke-soft);
        }

        .update-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--state-warning-base);
            flex-shrink: 0;
            margin-top: 4px;
        }

        .update-dot.investigating { background: var(--state-warning-base); }
        .update-dot.identified { background: var(--state-information-base); }
        .update-dot.monitoring { background: var(--state-verified-base); }
        .update-dot.resolved { background: var(--state-success-base); }

        .update-content {
            flex: 1;
        }

        .update-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .update-status {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-strong);
        }

        .update-time {
            font-size: 12px;
            color: var(--text-soft);
        }

        .update-message {
            font-size: 14px;
            color: var(--text-sub);
            line-height: 1.5;
        }

        /* Latency Table in Panel */
        .panel-latency-table {
            width: 100%;
            border-collapse: collapse;
        }

        .panel-latency-table th,
        .panel-latency-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--stroke-soft);
            font-size: 13px;
        }

        .panel-latency-table th {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-soft);
            background: var(--bg-weak);
        }

        .panel-latency-table td {
            color: var(--text-strong);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-soft);
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            fill: var(--text-disabled);
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .latency-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 16px;
            }
            
            .header-center {
                display: none;
            }

            .globe-hero-content h1 {
                font-size: 32px;
            }

            .container {
                padding: 0 16px;
            }

            .region-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <span class="logo">Cloudzy</span>
            <div class="logo-divider"></div>
            <span class="logo-status">Status</span>
        </div>
        <div class="header-center">
            <div class="global-status-chip operational">
                <span class="status-dot"></span>
                All Systems Operational
            </div>
        </div>
        <div class="header-right">
            <a href="#" class="header-link">Subscribe</a>
            <a href="#" class="header-link">API</a>
            <a href="#" class="header-link">Support</a>
            <a href="#" class="header-link">History</a>
            <button class="theme-toggle" onclick="toggleTheme()">
                <svg class="sun-icon" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>
                <svg class="moon-icon" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
            </button>
        </div>
    </header>

    <!-- Globe Section -->
    <section class="globe-section" id="globe-section">
        <div id="globe-container"></div>
        <div id="labels-container"></div>
        
        <div class="globe-hero-content">
            <h1>Cloudzy Global Infrastructure Status</h1>
        </div>

        <div class="scroll-indicator">
            <span>Scroll to explore</span>
            <svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>
        </div>
    </section>

    <div id="region-tooltip">
        <div class="region-name">Region Name</div>
        <div class="delay-list"></div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Summary -->
        <section class="hero-summary">
            <div class="container">
                <h2>Service Status</h2>
                <p>All Cloudzy services are operating normally across all regions</p>
                <div class="status-badge-large operational">
                    <svg class="check-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
                    All Systems Operational
                </div>
                <div class="last-updated">Last updated: <span id="last-update-time"></span> â€¢ All times in UTC</div>
            </div>
        </section>

        <!-- Region Status Section -->
        <section class="section">
            <div class="container">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Region Status</h2>
                        <p class="section-subtitle">Current status of all Cloudzy data center regions</p>
                    </div>
                </div>
                <div class="region-grid" id="region-grid">
                    <!-- Region cards will be generated by JS -->
                </div>
            </div>
        </section>

        <!-- Network Health & Latency -->
        <section class="section">
            <div class="container">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Network Health & Inter-Region Latency</h2>
                        <p class="section-subtitle">Real-time network performance from Dallas (US-Central) hub</p>
                    </div>
                </div>
                <div class="latency-section">
                    <div class="latency-info">
                        <h3>Network Performance</h3>
                        <p>Monitor latency between our global data centers. All measurements are updated in real-time.</p>
                        <div class="latency-legend">
                            <div class="legend-item"><div class="legend-dot low"></div> Normal (&lt;80ms)</div>
                            <div class="legend-item"><div class="legend-dot medium"></div> Elevated (80-150ms)</div>
                            <div class="legend-item"><div class="legend-dot high"></div> High (&gt;150ms)</div>
                        </div>
                    </div>
                    <table class="latency-table" id="latency-table">
                        <thead>
                            <tr>
                                <th>Destination</th>
                                <th>Avg Latency</th>
                                <th>95th Percentile</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Notifications -->
        <section class="section" style="border-bottom: none;">
            <div class="container">
                <div class="notify-section">
                    <h3>Stay Informed</h3>
                    <p>Subscribe to receive notifications about outages and scheduled maintenance</p>
                    <div class="notify-buttons">
                        <a href="#" class="btn btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                            Subscribe via Email
                        </a>
                        <a href="#" class="btn btn-secondary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg>
                            RSS Feed
                        </a>
                        <a href="#" class="btn btn-secondary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                            API &amp; Webhooks
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#">Cloudzy Home</a>
                    <a href="#">Documentation</a>
                    <a href="#">Security</a>
                    <a href="#">Privacy</a>
                    <a href="#">Terms</a>
                </div>
                <div class="footer-meta">
                    Target uptime: 99.99% for core services â€¢ Status powered by Cloudzy
                </div>
            </div>
        </div>
    </footer>

    <!-- Region Detail Panel -->
    <div class="region-panel-overlay" id="region-panel-overlay" onclick="closeRegionPanel()"></div>
    <div class="region-panel" id="region-panel">
        <div class="panel-header">
            <div class="panel-header-top">
                <div class="panel-title">
                    <h2 id="panel-region-name">Region Name</h2>
                    <span class="region-code" id="panel-region-code">CODE</span>
                </div>
                <button class="panel-close" onclick="closeRegionPanel()">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
                </button>
            </div>
            <div id="panel-status-badge"></div>
        </div>
        <div class="panel-tabs">
            <button class="panel-tab active" data-tab="overview" onclick="switchTab('overview')">Overview</button>
            <button class="panel-tab" data-tab="incidents" onclick="switchTab('incidents')">Incidents</button>
            <button class="panel-tab" data-tab="maintenance" onclick="switchTab('maintenance')">Maintenance</button>
            <button class="panel-tab" data-tab="latency" onclick="switchTab('latency')">Latency & Performance</button>
        </div>
        <div class="panel-content" id="panel-content">
            <!-- Content will be dynamically generated -->
        </div>
    </div>

    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script>
        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateGlobeTheme();
        }

        // Initialize theme
        (function() {
            const saved = localStorage.getItem('theme');
            if (saved) {
                document.documentElement.setAttribute('data-theme', saved);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();

        function getCurrentTheme() {
            return document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
        }

        function updateGlobeTheme() {
            if (typeof scene === 'undefined') return;
            
            const theme = getCurrentTheme();
            const colors = CONFIG[theme];
            
            // Update scene background
            scene.background = new THREE.Color(colors.backgroundColor);
            
            // Update globe material
            if (typeof globe !== 'undefined') {
                globe.material.color.setHex(colors.globeColor);
                globe.material.emissive.setHex(colors.globeEmissive);
                globe.material.opacity = 0.5;
            }
            
            // Update atmosphere
            if (typeof atmosphereMaterial !== 'undefined') {
                atmosphereMaterial.uniforms.glowColor.value = new THREE.Color(colors.atmosphereColor);
                atmosphereMaterial.uniforms.opacity.value = 0.15;
            }
            
            // Update land dots
            if (typeof landDots !== 'undefined' && landDots.children[0]) {
                landDots.children[0].material.color.setHex(colors.landColor);
            }
            
            // Update region markers (only operational ones get theme color)
            if (typeof regionMarkers !== 'undefined' && typeof REGION_STATUS_DATA !== 'undefined') {
                regionMarkers.forEach(r => {
                    const regionData = REGION_STATUS_DATA.find(rd => rd.name === r.name);
                    const isOperational = !regionData || regionData.status === 'operational';
                    
                    // Only update color for operational regions; status regions keep their status color
                    if (isOperational) {
                        r.marker.material.color.setHex(colors.markerColor);
                        r.ring.material.color.setHex(colors.markerColor);
                        r.pulse.material.color.setHex(colors.markerColor);
                    }
                    r.baseDot.material.color.setHex(colors.markerColor);
                    r.pole.material.color.setHex(colors.markerColor);
                });
            } else if (typeof regionMarkers !== 'undefined') {
                regionMarkers.forEach(r => {
                    r.marker.material.color.setHex(colors.markerColor);
                    r.ring.material.color.setHex(colors.markerColor);
                    r.pulse.material.color.setHex(colors.markerColor);
                    r.baseDot.material.color.setHex(colors.markerColor);
                    r.pole.material.color.setHex(colors.markerColor);
                });
            }
        }

        // Modern sharp blue-primary color scheme
        const CONFIG = {
            // Theme colors - dark globe for both modes for consistency & readability
            light: {
                backgroundColor: 0x0e121b,
                globeColor: 0x0A2540,
                globeEmissive: 0x051525,
                landColor: 0x0095ff,
                atmosphereColor: 0x0095ff,
                markerColor: 0x51b1f6
            },
            dark: {
                backgroundColor: 0x0e121b,
                globeColor: 0x0A2540,
                globeEmissive: 0x051525,
                landColor: 0x4488CC,
                atmosphereColor: 0x3399FF,
                markerColor: 0x8fd0ff
            },
            
            globeRadius: 20,
            globeSegments: 72,
            atmosphereOpacity: 0.25,
            
            // Land points
            numPoints: 100000,
            dotSize: 0.04,
            dotOpacity: 0.5,
            
            // Markers - smaller, high-tech
            markerSize: 0.12,
            flagpoleHeight: 0.18,
            ringInner: 0.18,
            ringOuter: 0.28,
            
            // Arcs
            arcThickness: 0.025,
            arcPointsCount: 50,
            
            // Animation
            rotationSpeed: 0.0005,
            
            // Zoom - fixed, no mouse wheel
            fixedZoom: 30,
            
            // Scroll behavior
            defaultZoom: 26,
            scrolledZoom: 38
        };

        // Corrected region coordinates with country flags emoji
        const REGIONS = [
            { name: 'Utah', lat: 32.76, lon: 60.89, color: 0xD5EBFF, flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'Bern', lat: 45.95, lon: -87.447, color: 0xD5EBFF, flag: 'ðŸ‡¨ðŸ‡­' },
            { name: 'New York', lat: 40.71, lon: 6.01, color: 0xD5EBFF, flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'Miami', lat: 17.76, lon: 25.19, color: 0xD5EBFF, flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'Dallas', lat: 25.78, lon: 40.80, color: 0xD5EBFF, flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'Frankfurt', lat: 50.11, lon: -95.68, color: 0xD5EBFF, flag: 'ðŸ‡©ðŸ‡ª' },
            { name: 'Las Vegas', lat: 30.17, lon: 70.14, color: 0xD5EBFF, flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'Amsterdam', lat: 52.37, lon: -78.90, color: 0xD5EBFF, flag: 'ðŸ‡³ðŸ‡±' },
            { name: 'Dubai', lat: 16.00, lon: 215.99, color: 0xD5EBFF, flag: 'ðŸ‡¦ðŸ‡ª' },
            { name: 'Los Angeles', lat: 50.05, lon: 65.24, color: 0xD5EBFF, flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'London', lat: 50.51, lon: -69.13, color: 0xD5EBFF, flag: 'ðŸ‡¬ðŸ‡§' },
            { name: 'Singapore', lat: -10.35, lon: 155.82, color: 0xD5EBFF, flag: 'ðŸ‡¸ðŸ‡¬' }
        ];

        // Network delays
        const NETWORK_DELAYS = {
            'Utah': { 'Bern': 142, 'New York': 52, 'Miami': 68, 'Dallas': 32, 'Frankfurt': 148, 'Las Vegas': 18, 'Amsterdam': 152, 'Dubai': 245, 'Los Angeles': 28, 'London': 138, 'Singapore': 198 },
            'Bern': { 'Utah': 142, 'New York': 92, 'Miami': 118, 'Dallas': 128, 'Frankfurt': 12, 'Las Vegas': 158, 'Amsterdam': 18, 'Dubai': 112, 'Los Angeles': 162, 'London': 22, 'Singapore': 168 },
            'New York': { 'Utah': 52, 'Bern': 92, 'Miami': 28, 'Dallas': 38, 'Frankfurt': 88, 'Las Vegas': 62, 'Amsterdam': 82, 'Dubai': 198, 'Los Angeles': 68, 'London': 72, 'Singapore': 238 },
            'Miami': { 'Utah': 68, 'Bern': 118, 'New York': 28, 'Dallas': 28, 'Frankfurt': 108, 'Las Vegas': 58, 'Amsterdam': 102, 'Dubai': 218, 'Los Angeles': 62, 'London': 92, 'Singapore': 252 },
            'Dallas': { 'Utah': 32, 'Bern': 128, 'New York': 38, 'Miami': 28, 'Frankfurt': 122, 'Las Vegas': 28, 'Amsterdam': 118, 'Dubai': 228, 'Los Angeles': 32, 'London': 108, 'Singapore': 218 },
            'Frankfurt': { 'Utah': 148, 'Bern': 12, 'New York': 88, 'Miami': 108, 'Dallas': 122, 'Las Vegas': 152, 'Amsterdam': 8, 'Dubai': 98, 'Los Angeles': 158, 'London': 14, 'Singapore': 162 },
            'Las Vegas': { 'Utah': 18, 'Bern': 158, 'New York': 62, 'Miami': 58, 'Dallas': 28, 'Frankfurt': 152, 'Amsterdam': 158, 'Dubai': 258, 'Los Angeles': 8, 'London': 148, 'Singapore': 188 },
            'Amsterdam': { 'Utah': 152, 'Bern': 18, 'New York': 82, 'Miami': 102, 'Dallas': 118, 'Frankfurt': 8, 'Las Vegas': 158, 'Dubai': 108, 'Los Angeles': 162, 'London': 12, 'Singapore': 172 },
            'Dubai': { 'Utah': 245, 'Bern': 112, 'New York': 198, 'Miami': 218, 'Dallas': 228, 'Frankfurt': 98, 'Las Vegas': 258, 'Amsterdam': 108, 'Los Angeles': 268, 'London': 102, 'Singapore': 68 },
            'Los Angeles': { 'Utah': 28, 'Bern': 162, 'New York': 68, 'Miami': 62, 'Dallas': 32, 'Frankfurt': 158, 'Las Vegas': 8, 'Amsterdam': 162, 'Dubai': 268, 'London': 152, 'Singapore': 178 },
            'London': { 'Utah': 138, 'Bern': 22, 'New York': 72, 'Miami': 92, 'Dallas': 108, 'Frankfurt': 14, 'Las Vegas': 148, 'Amsterdam': 12, 'Dubai': 102, 'Los Angeles': 152, 'Singapore': 178 },
            'Singapore': { 'Utah': 198, 'Bern': 168, 'New York': 238, 'Miami': 252, 'Dallas': 218, 'Frankfurt': 162, 'Las Vegas': 188, 'Amsterdam': 172, 'Dubai': 68, 'Los Angeles': 178, 'London': 178 }
        };

        // Scene setup
        const globeContainer = document.getElementById('globe-container');
        const globeSection = document.getElementById('globe-section');
        const scene = new THREE.Scene();
        const initialTheme = getCurrentTheme();
        scene.background = new THREE.Color(CONFIG[initialTheme].backgroundColor);
        
        const camera = new THREE.PerspectiveCamera(75, globeContainer.clientWidth / globeContainer.clientHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance", alpha: true });
        renderer.setSize(globeContainer.clientWidth, globeContainer.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        globeContainer.appendChild(renderer.domElement);

        // Scroll handling for globe scaling
        let scrollProgress = 0;
        const labelsContainerEl = document.getElementById('labels-container');
        
        window.addEventListener('scroll', () => {
            const scrollTop = window.scrollY;
            const sectionHeight = globeSection.offsetHeight;
            scrollProgress = Math.min(1, scrollTop / (sectionHeight * 0.5));
            
            // Scale globe section height and camera zoom based on scroll
            const newHeight = Math.max(50, 100 - scrollProgress * 40);
            globeSection.style.height = newHeight + 'vh';
            
            // Zoom out as user scrolls
            targetZoom = CONFIG.defaultZoom + (scrollProgress * 12);
            
            // Hide labels when scrolled past globe
            labelsContainerEl.style.opacity = Math.max(0, 1 - scrollProgress * 2);
        });
        
        const globeGroup = new THREE.Group();
        // Move the globe group directly
        globeGroup.position.set(0, -10, 0);  // Shift globe down by 2 units
        scene.add(globeGroup);
        
        const radius = CONFIG.globeRadius;

        // Modern blue globe with sharp colors - theme aware
        const themeColors = CONFIG[initialTheme];
        const globeGeometry = new THREE.SphereGeometry(radius, CONFIG.globeSegments, CONFIG.globeSegments);
        const globeMaterial = new THREE.MeshPhongMaterial({
            color: themeColors.globeColor,
            shininess: 30,
            specular: 0x1A4A80,
            emissive: themeColors.globeEmissive,
            transparent: true,
            opacity: initialTheme === 'light' ? 0.7 : 0.5
        });
        const globe = new THREE.Mesh(globeGeometry, globeMaterial);
        globeGroup.add(globe);

        // Inner glow
        const innerGlow = new THREE.Mesh(
            new THREE.SphereGeometry(radius * 1.008, 48, 48),
            new THREE.MeshBasicMaterial({
                color: 0x0066CC,
                transparent: true,
                opacity: 0.05,
                side: THREE.BackSide
            })
        );
        globeGroup.add(innerGlow);

        // Atmosphere - theme aware
        const atmosphereMaterial = new THREE.ShaderMaterial({
            uniforms: {
                glowColor: { value: new THREE.Color(themeColors.atmosphereColor) },
                opacity: { value: initialTheme === 'light' ? 0.15 : CONFIG.atmosphereOpacity },
                time: { value: 0.0 }
            },
            vertexShader: `
                varying vec3 vNormal;
                void main() {
                    vNormal = normalize(normalMatrix * normal);
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform vec3 glowColor;
                uniform float opacity;
                uniform float time;
                varying vec3 vNormal;
                void main() {
                    float intensity = pow(0.7 - dot(vNormal, vec3(0, 0, 1.0)), 2.5);
                    float pulse = 1.0 + 0.08 * sin(time * 0.4);
                    gl_FragColor = vec4(glowColor * pulse, opacity * intensity * 2.0);
                }
            `,
            side: THREE.BackSide,
            transparent: true,
            blending: THREE.AdditiveBlending,
            depthWrite: false
        });
        const atmosphere = new THREE.Mesh(new THREE.SphereGeometry(radius * 1.12, 64, 64), atmosphereMaterial);
        globeGroup.add(atmosphere);

        // Lights - modern blue tones
        scene.add(new THREE.AmbientLight(0x1a2a4a, 0.6));
        
        const mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
        mainLight.position.set(10, 10, 10);
        scene.add(mainLight);
        
        const blueLight = new THREE.PointLight(0x0088FF, 3, 80);
        blueLight.position.set(-25, 10, -25);
        scene.add(blueLight);
        
        const accentLight = new THREE.PointLight(0x00AAFF, 2, 60);
        accentLight.position.set(15, -10, 20);
        scene.add(accentLight);

        // Camera position
        let targetZoom = CONFIG.defaultZoom;
        camera.position.z = targetZoom;
        camera.position.y = 2;
        camera.lookAt(0, 0, 0);

        // ============ LAND DOTS ============
        const landDots = new THREE.Group();
        globeGroup.add(landDots);

        const worldMap = ["000000000000000000000000000000000000000000000000000000001111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000000111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000001111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000001111111110111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000000111111000011111111111111111111110000000000000000000000000000000000000000000000000011111111100000000000000000000000000000000000000000000000000","000000000000000000000000000000001110000000000000000000000000000011111111111111111110000000000000000000000000000000000000000000000000111111111111100000000000000000000000000000000000000000000000000","000000000000000000000000000000111111101110000000111111100000000011111111111111110000000000000000000000000000000000000000000011100111111111111111111100111100000011000000000000000000000000000000000","000000000000001111100000000000111111111110011100111111111000000001111111111111110000000000000000000000000000000000000000000011111111111111111111111111111111110011111111110000000000000000000000000","000000001111111111110000111110000111111110011100110111111000000001111111111111110000000000000000000001111111110000000000110011111111111111111111111111111111111111111111111111110011100000000000000","000001111111111111111111111111111111111100111111110001111100001111111111111111100000000000000000000111111111111110001111111101111111111111111111111111111111111111111111111111111111111111000000000","000111111111111111111111111111111111111111111111100001111100000111111111100000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000","001111111111111111111111111111111111111111111110000111111100000111111111000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000","001111111111111111111111111111111111111111111000000111111000000111111000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111000","111111111111111111111111111111111111111111110000010011110000000111111000000000000000000000000001111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000","111111111111111111111111111111111111111110000000111100110000000011110000000000000000000000000011111111011111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000","111111111111111111111111111111111111111000000011111100110000000001100000000000000000000000000011111111011111111111111111111111111111111111111111111111111111111111111111111111111100011111100000000","111110100000111111111111111111111111110000000011111111110000000000000000000000000000000000000011111111001111111111111111111111111111111111111111111111111111111111111111111111111100111101000000000","011000000000011111111111111111111111111000000011111111110000000000000000000000000000000000000000011110111111111111111111111111111111111111111111111111111111111111111111111000000000111110000000000","000000000000001111111111111111111111111111100011111111110000000000000000000000000000000000000000011110111111111111111111111111111111111111111111111111111111111111111111111000000000111111000000000","000000000000011111111111111111111111111111111111111111111100000000000000000000000000000000000001111011111111111111111111111111111111111111111111111111111111111111111111111000000000011111000000000","000000000000011111111111111111111111111111011111111111111100000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111100000001111000000000","000000000000011111111111111111111111111111111111111111111100000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000111000000000","000000000000011111111111111111111111111111111111111111111000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000011000000000","000000000000001111111111111111111111111111111111111111000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000","000000000000011111111111111111111111111111111111111100000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000","000000000000011111111111111111111111111111111111111111000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000","000000000000111111111111111111111111111111111111111111000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000100000000000000","000000000001111111111111111111111111111111111111111100000000000000000000000000000000011001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000110000000000000","000000000001111111111111111111111111111111111110110000000000000000000000000000000000111111111110111111111111111111111111111111111111111111111111111111111111111111111111111111110000111000000000000","000000000011111111111111111111111111111111111100000000000000000000000000000000000000111111111000011111111111111111111111111111111111111111111111111111111111111111111111111111000000111000000000000","000000000111111111111111111111111111111111111000000000000000000000000000000000000000111111110000000111111111111111111111111111111111111111111111111111111111111111111111111111000000110000000000000","000000000111111111111111111111111111111111100000000000000000000000000000000000000000111111100000000111111101111111111111111111111111111111111111111111111111111111111111011111000000110000000000000","000000000111111111111111111111111111111111000000000000000000000000000000000000000000111111100000001110011101111111111111111111111111111111111111111111111111111111111110000111100010110000000000000","000000000111111111111111111111111111111110000000000000000000000000000000000000000000111110011111111100011101111111111111111111111111111111111111111111111111111111111111110111110111111000000000000","000000000111111111111111111111111111111110000000000000000000000000000000000000000000001111111111110000000000011011111111111111111111111111111111111111111111111111111111110011110111111000000000000","000000000011111111111111111111111111111000000000000000000000000000000000000000000000011111111111100000000000000001111111111111111111111111111111111111111111111111111111110011100111110000000000000","000000000001111111111111111111111111110000000000000000000000000000000000000000000001111111111111111000011000000001111111111111111111111111111111111111111111111111111111110000000000000000000000000","000000000000111111111111111111111111100000000000000000000000000000000000000000000001111111111111111110011111110011111111111111111111111111111111111111111111111111111111111100000000000000000000000","000000000001111111111111111111111111000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000","000000000000111111111111111111100111000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000","000000000000111111111111110000000111000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000","000000000000111111111111000000000111000000000000000000000000000000000000000000001111111111111111111111111111111110111111111101111111111111111111111111111111111111111111111100000000000000000000000","000000000000011111111111000000000011000000000000000000000000000000000000000000011111111111111111111111111111111111111111111100011111111111111111111111111111111111111111111100000000000000000000000","000000000000011011111111000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111011111111111111000001111111111111111111111111111111111111000000000000000000000000","000000000000000011111111000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111110000011111111111111111111111111111111110000000000000000000000000","000000000000000011111110000111000000000000000000000000000000000000000000000000111111111111111111111111111111111111101111111111111110000001111111111111111111111111111111000000000000000000000000000","000000000000000001111111000111000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111110000000111111111111000111111111100110000000000000000000000000000","000000000000000001111111101111000000000000000000000000000000000000000000000000111111111111111111111111111111111111110111111111111100000000001111111110000111111111101110000000000000000000000000000","000000000000000001111111111111000000000000000000000000000000000000000000000000111111111111111111111111111111111111111011111111111000000000001111111100000011111111111100000000000000000000000000000","000000000000000000011111111111100000000000000000000000000000000000000000000000111111111111111111111111111111111111111011111111110000000000001111111000000001111111111000000000000000000000000000000","000000000000000000000111111111110000000000000000000000000000000000000000000001111111111111111111111111111111111111111101111111100000000000001111110000000001111111111000000000000000000000000000000","000000000000000000000000011111110000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111110000000000000000111110000000000011111111100000000000000000000000000000","000000000000000000000000000111110000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111000000000000000000111110000000000011111111100000000000000000000000000000","000000000000000000000000000001110000001111000000000000000000000000000000000001111111111111111111111111111111111111111111000011000000000000000111110000000000011111111100000000000000000000000000000","000000000000000000000000000001110000111111111100000000000000000000000000000000011111111111111111111111111111111111111111111111000000000000000011110000000000011111111100000000000000000000000000000","000000000000000000000000000001111001111111111110000000000000000000000000000000011111111111111111111111111111111111111111111111000000000000000011110000000000011101111000000000000000000000000000000","000000000000000000000000000000011101111111111111100000000000000000000000000000001111111111111111111111111111111111111111111110000000000000000001100000000000001100100000000000000000000000000000000","000000000000000000000000000000000101111111111111110000000000000000000000000000000111111111111111111111111111111111111111111110000000000000000000000000000000000000000000001100000000000000000000000","000000000000000000000000000000000001111111111111111110000000000000000000000000000111111111111111111111111111111111111111111100000000000000000000000000000000110000000000001110000000000000000000000","000000000000000000000000000000000001111111111111111111000000000000000000000000000001111100000111111111111111111111111111111000000000000000000000000000000000111000000000111110000000000000000000000","000000000000000000000000000000000011111111111111111111100000000000000000000000000000000000000000111111111111111111111111111000000000000000000000000000000000011100000001111110000000000000000000000","000000000000000000000000000000000011111111111111111111100000000000000000000000000000000000000000111111111111111111111111110000000000000000000000000000000000011110000011111110000000000000000000000","000000000000000000000000000000000111111111111111111111100000000000000000000000000000000000000000111111111111111111111111100000000000000000000000000000000000001111000111111110000000000000000000000","000000000000000000000000000000001111111111111111111111111000000000000000000000000000000000000001111111111111111111111111000000000000000000000000000000000000000111100111111100000000011100000000000","000000000000000000000000000000001111111111111111111111111111000000000000000000000000000000000001111111111111111111111111000000000000000000000000000000000000000111100011111100000000011101100000000","000000000000000000000000000000000111111111111111111111111111111000000000000000000000000000000000111111111111111111111110000000000000000000000000000000000000000011110011111000000000001111111100000","000000000000000000000000000000001111111111111111111111111111111110000000000000000000000000000000011111111111111111111100000000000000000000000000000000000000000011110000000000000000001111111111000","000000000000000000000000000000001111111111111111111111111111111111000000000000000000000000000000011111111111111111111000000000000000000000000000000000000000000001110000000000000000000001111111100","000000000000000000000000000000000111111111111111111111111111111111000000000000000000000000000000001111111111111111111100000000000000000000000000000000000000000000110000000000000000000000111111100","000000000000000000000000000000000011111111111111111111111111111111000000000000000000000000000000001111111111111111111100000000000000000000000000000000000000000000000000000000000000000000111111110","000000000000000000000000000000000011111111111111111111111111111110000000000000000000000000000000001111111111111111111100000000000000000000000000000000000000000000000000000000000000000000011101111","000000000000000000000000000000000001111111111111111111111111111100000000000000000000000000000000001111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000111","000000000000000000000000000000000001111111111111111111111111111100000000000000000000000000000000000111111111111111111100000000000000000000000000000000000000000000000000000000000000011110001100001","000000000000000000000000000000000001111111111111111111111111111100000000000000000000000000000000001111111111111111111100000110000000000000000000000000000000000000000000000000000000111110001100000","000000000000000000000000000000000000111111111111111111111111111000000000000000000000000000000000001111111111111111111100001110000000000000000000000000000000000000000000000000001111111100011100000","000000000000000000000000000000000000011111111111111111111111111000000000000000000000000000000000011111111111111111111100111110000000000000000000000000000000000000000000000000011111111110011110000","000000000000000000000000000000000000001111111111111111111111111000000000000000000000000000000000011111111111111111111000111110000000000000000000000000000000000000000000000000111111111111111110000","000000000000000000000000000000000000000011111111111111111111111000000000000000000000000000000000011111111111111111110000111110000000000000000000000000000000000000000000000001111111111111111110000","000000000000000000000000000000000000000001111111111111111111111000000000000000000000000000000000001111111111111111100000111100000000000000000000000000000000000000000000000011111111111111111111000","000000000000000000000000000000000000000001111111111111111111110000000000000000000000000000000000001111111111111111100001111100000000000000000000000000000000000000000000011111111111111111111111000","000000000000000000000000000000000000000001111111111111111111110000000000000000000000000000000000000111111111111111100001111000000000000000000000000000000000000000000001111111111111111111111111100","000000000000000000000000000000000000000001111111111111111111110000000000000000000000000000000000000111111111111111100001111000000000000000000000000000000000000000000001111111111111111111111111110","000000000000000000000000000000000000000001111111111111111110000000000000000000000000000000000000000111111111111111100001111000000000000000000000000000000000000000000001111111111111111111111111110","000000000000000000000000000000000000000001111111111111111000000000000000000000000000000000000000000111111111111111000001111000000000000000000000000000000000000000000001111111111111111111111111110","000000000000000000000000000000000000000001111111111111111100000000000000000000000000000000000000000011111111111110000000000000000000000000000000000000000000000000000001111111111111111111111111110","000000000000000000000000000000000000000001111111111111111000000000000000000000000000000000000000000011111111111100000000000000000000000000000000000000000000000000000011111111111111111111111111110","000000000000000000000000000000000000000001111111111111111000000000000000000000000000000000000000000011111111111100000000000000000000000000000000000000000000000000000011111111111111111111111111110","000000000000000000000000000000000000000001111111111111110000000000000000000000000000000000000000000001111111111000000000000000000000000000000000000000000000000000000001111111111111111111111111110","000000000000000000000000000000000000000001111111111111110000000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000000000000000001111111111111111111111111100","000000000000000000000000000000000000000000111111111111100000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000000000000011111111100011111111111111000","000000000000000000000000000000000000000000111111111111100000000000000000000000000000000000000000000000111110000000000000000000000000000000000000000000000000000000000011111100000001111111111110000","000000000000000000000000000000000000000000111111111110000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000011000000000000011111111100000","000000000000000000000000000000000000000000111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111000000","000000000000000000000000000000000000000000111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111110000000","000000000000000000000000000000000000000000111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111000000000","000000000000000000000000000000000000000000111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000011111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000011111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000011111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000001111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"];

        function isLand(lat, lon) {
            const latIdx = Math.min(worldMap.length - 1, Math.max(0, Math.floor((90 - lat) * worldMap.length / 180)));
            const lonIdx = Math.min(worldMap[0].length - 1, Math.max(0, Math.floor((lon + 180) * worldMap[0].length / 360)));
            return worldMap[latIdx]?.[lonIdx] === '1';
        }

        function createLandPoints() {
            const geo = new THREE.CircleGeometry(CONFIG.dotSize, 6);
            const mat = new THREE.MeshBasicMaterial({ color: themeColors.landColor, side: THREE.DoubleSide, transparent: true, opacity: CONFIG.dotOpacity });
            const positions = [], normals = [];

            for (let i = 0; i < CONFIG.numPoints; i++) {
                const phi = Math.acos(1 - 2 * (i + 0.5) / CONFIG.numPoints);
                const theta = Math.PI * (1 + Math.sqrt(5)) * (i + 0.5);
                const lat = 90 - (phi * 180 / Math.PI);
                const lon = (theta * 180 / Math.PI) % 360 - 180;
                if (isLand(lat, lon)) {
                    const p = (90 - lat) * Math.PI / 180, t = (lon + 180) * Math.PI / 180;
                    const r = radius * 1.003;
                    const x = -r * Math.sin(p) * Math.cos(t), y = r * Math.cos(p), z = r * Math.sin(p) * Math.sin(t);
                    positions.push(x, y, z);
                    const n = new THREE.Vector3(x, y, z).normalize();
                    normals.push(n.x, n.y, n.z);
                }
            }

            const count = positions.length / 3;
            if (count > 0) {
                const mesh = new THREE.InstancedMesh(geo, mat, count);
                const m = new THREE.Matrix4(), q = new THREE.Quaternion(), pos = new THREE.Vector3(), s = new THREE.Vector3(1, 1, 1);
                for (let i = 0; i < count; i++) {
                    pos.set(positions[i * 3], positions[i * 3 + 1], positions[i * 3 + 2]);
                    const n = new THREE.Vector3(normals[i * 3], normals[i * 3 + 1], normals[i * 3 + 2]);
                    const rm = new THREE.Matrix4().lookAt(pos, pos.clone().add(n), new THREE.Vector3(0, 1, 0));
                    q.setFromRotationMatrix(rm);
                    m.compose(pos, q, s);
                    mesh.setMatrixAt(i, m);
                }
                mesh.instanceMatrix.needsUpdate = true;
                landDots.add(mesh);
            }
        }
        createLandPoints();

        // ============ REGION MARKERS WITH FLAGS ============
        const regionMarkers = [];
        const regionGroup = new THREE.Group();
        globeGroup.add(regionGroup);
        const labelsContainer = document.getElementById('labels-container');

        function latLonToVector3(lat, lon, r) {
            // Convert lat/lon to radians
            const latRad = lat * Math.PI / 180;
            const lonRad = -lon * Math.PI / 180; // Negative to match geographic convention
            
            // Spherical to Cartesian conversion (Y-up coordinate system)
            const x = r * Math.cos(latRad) * Math.sin(lonRad);
            const y = r * Math.sin(latRad);
            const z = r * Math.cos(latRad) * Math.cos(lonRad);
            
            return new THREE.Vector3(x, y, z);
        }

        // Get region status from REGION_STATUS_DATA
        function getRegionStatus(regionName) {
            // Will be populated after REGION_STATUS_DATA is defined
            return null;
        }

        function createRegionMarker(region) {
            const markerColor = themeColors.markerColor;
            const basePos = latLonToVector3(region.lat, region.lon, radius * 1.003);
            const normal = basePos.clone().normalize();
            const flagPos = basePos.clone().add(normal.clone().multiplyScalar(CONFIG.flagpoleHeight));

            // Thin high-tech pole line
            const poleGeo = new THREE.BufferGeometry().setFromPoints([basePos, flagPos]);
            const poleMat = new THREE.LineBasicMaterial({ color: markerColor, transparent: true, opacity: 0.4 });
            const pole = new THREE.Line(poleGeo, poleMat);
            regionGroup.add(pole);

            // Small base dot on globe
            const baseDotGeo = new THREE.SphereGeometry(0.05, 8, 8);
            const baseDotMat = new THREE.MeshBasicMaterial({ color: markerColor, transparent: true, opacity: 0.9 });
            const baseDot = new THREE.Mesh(baseDotGeo, baseDotMat);
            baseDot.position.copy(basePos);
            regionGroup.add(baseDot);

            // Small marker dot at top - high-tech feel
            const markerGeo = new THREE.SphereGeometry(CONFIG.markerSize, 12, 12);
            const markerMat = new THREE.MeshBasicMaterial({ color: markerColor, transparent: true, opacity: 0.95 });
            const marker = new THREE.Mesh(markerGeo, markerMat);
            marker.position.copy(flagPos);
            regionGroup.add(marker);

            // Inner tech ring
            const ringGeo = new THREE.RingGeometry(CONFIG.ringInner, CONFIG.ringOuter, 32);
            const ringMat = new THREE.MeshBasicMaterial({ color: markerColor, transparent: true, opacity: 0.25, side: THREE.DoubleSide, blending: THREE.AdditiveBlending });
            const ring = new THREE.Mesh(ringGeo, ringMat);
            ring.position.copy(flagPos);
            ring.lookAt(camera.position);
            regionGroup.add(ring);

            // Outer pulse ring - smaller
            const pulseGeo = new THREE.RingGeometry(CONFIG.ringOuter + 0.05, CONFIG.ringOuter + 0.12, 32);
            const pulseMat = new THREE.MeshBasicMaterial({ color: markerColor, transparent: true, opacity: 0.1, side: THREE.DoubleSide, blending: THREE.AdditiveBlending });
            const pulse = new THREE.Mesh(pulseGeo, pulseMat);
            pulse.position.copy(flagPos);
            pulse.lookAt(camera.position);
            regionGroup.add(pulse);

            // HTML label with flag - bigger text
            const label = document.createElement('div');
            label.className = 'region-label';
            label.innerHTML = `<span class="flag">${region.flag}</span> ${region.name}`;
            labelsContainer.appendChild(label);

            return {
                name: region.name, position: flagPos.clone(), basePosition: basePos.clone(),
                marker, ring, pulse, pole, baseDot, color: new THREE.Color(markerColor),
                lat: region.lat, lon: region.lon, label, flag: region.flag,
                markerMat, ringMat, pulseMat
            };
        }

        REGIONS.forEach(r => regionMarkers.push(createRegionMarker(r)));

        // Apply initial theme to globe after all elements are created
        setTimeout(() => updateGlobeTheme(), 100);

        // ============ PERSISTENT ARCS (lighter on load) ============
        const persistentArcs = [];
        const arcsGroup = new THREE.Group();
        globeGroup.add(arcsGroup);

        // Data packet group for transfer animations
        const dataPacketsGroup = new THREE.Group();
        globeGroup.add(dataPacketsGroup);

        function createPersistentArc(startR, endR) {
            const s = startR.position.clone(), e = endR.position.clone();
            const mid = s.clone().add(e).multiplyScalar(0.5);
            mid.normalize().multiplyScalar(radius + s.distanceTo(e) * 0.35);

            const pts = [];
            for (let i = 0; i <= 40; i++) {
                const t = i / 40, u = 1 - t;
                pts.push(new THREE.Vector3(
                    u * u * s.x + 2 * u * t * mid.x + t * t * e.x,
                    u * u * s.y + 2 * u * t * mid.y + t * t * e.y,
                    u * u * s.z + 2 * u * t * mid.z + t * t * e.z
                ));
            }

            // Light blue gradient for persistent arcs
            const canvas = document.createElement('canvas');
            canvas.width = 256; canvas.height = 1;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createLinearGradient(0, 0, 256, 0);
            grad.addColorStop(0, 'rgba(60, 160, 255, 0.6)');
            grad.addColorStop(0.5, 'rgba(100, 200, 255, 0.8)');
            grad.addColorStop(1, 'rgba(60, 160, 255, 0.6)');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 256, 1);
            const tex = new THREE.CanvasTexture(canvas);

            const curve = new THREE.CatmullRomCurve3(pts);
            curve.tension = 0.5;
            const geo = new THREE.TubeGeometry(curve, 16, 0.018, 6, false);
            const mat = new THREE.MeshBasicMaterial({ map: tex, transparent: true, opacity: 0.45, depthWrite: false, blending: THREE.AdditiveBlending });
            const arc = new THREE.Mesh(geo, mat);
            arcsGroup.add(arc);
            return { arc, mat, curve, pts };
        }

        // Create lighter persistent arcs
        const connections = [
            ['New York', 'London'], ['New York', 'Los Angeles'], ['London', 'Frankfurt'],
            ['London', 'Dubai'], ['Frankfurt', 'Singapore'], ['Dubai', 'Singapore'],
            ['Los Angeles', 'Las Vegas'], ['Los Angeles', 'Dallas'], ['Amsterdam', 'London'],
            ['Dallas', 'Miami'], ['Utah', 'Las Vegas'], ['Bern', 'Frankfurt']
        ];
        connections.forEach(([a, b]) => {
            const sa = regionMarkers.find(r => r.name === a), sb = regionMarkers.find(r => r.name === b);
            if (sa && sb) persistentArcs.push(createPersistentArc(sa, sb));
        });

        // ============ DATA PACKET ANIMATION ============
        const dataPackets = [];
        
        // Create a glowing data packet
        function createDataPacket(arcData, direction = 1, delay = 0) {
            // Core bright sphere
            const coreGeo = new THREE.SphereGeometry(0.06, 8, 8);
            const coreMat = new THREE.MeshBasicMaterial({
                color: 0x00ffff,
                transparent: true,
                opacity: 1,
                blending: THREE.AdditiveBlending
            });
            const core = new THREE.Mesh(coreGeo, coreMat);
            
            // Outer glow sphere
            const glowGeo = new THREE.SphereGeometry(0.12, 8, 8);
            const glowMat = new THREE.MeshBasicMaterial({
                color: 0x3399ff,
                transparent: true,
                opacity: 0.4,
                blending: THREE.AdditiveBlending
            });
            const glow = new THREE.Mesh(glowGeo, glowMat);
            
            // Trail particles
            const trailGroup = new THREE.Group();
            const trailCount = 5;
            for (let i = 0; i < trailCount; i++) {
                const trailGeo = new THREE.SphereGeometry(0.03 - i * 0.004, 6, 6);
                const trailMat = new THREE.MeshBasicMaterial({
                    color: 0x66ccff,
                    transparent: true,
                    opacity: 0.3 - i * 0.05,
                    blending: THREE.AdditiveBlending
                });
                const trail = new THREE.Mesh(trailGeo, trailMat);
                trail.userData.offset = (i + 1) * 0.02;
                trailGroup.add(trail);
            }
            
            const packetGroup = new THREE.Group();
            packetGroup.add(core);
            packetGroup.add(glow);
            packetGroup.add(trailGroup);
            dataPacketsGroup.add(packetGroup);
            
            return {
                group: packetGroup,
                core,
                glow,
                trailGroup,
                curve: arcData.curve,
                progress: direction === 1 ? 0 : 1,
                direction,
                speed: 0.08 + Math.random() * 0.06, // Slow speeds for visible effect
                delay,
                delayTimer: delay,
                active: delay === 0
            };
        }
        
        // Initialize data packets on arcs
        function initDataPackets() {
            persistentArcs.forEach((arcData, index) => {
                // Create 2-3 packets per arc with varied timing
                const numPackets = 2 + Math.floor(Math.random() * 2);
                for (let i = 0; i < numPackets; i++) {
                    const direction = Math.random() > 0.5 ? 1 : -1;
                    const delay = i * 2.5 + Math.random() * 4;
                    dataPackets.push(createDataPacket(arcData, direction, delay));
                }
            });
        }
        
        // Update data packets
        function updateDataPackets(dt) {
            dataPackets.forEach(packet => {
                if (!packet.active) {
                    packet.delayTimer -= dt;
                    if (packet.delayTimer <= 0) {
                        packet.active = true;
                        packet.group.visible = true;
                    } else {
                        packet.group.visible = false;
                        return;
                    }
                }
                
                // Move along curve slowly
                packet.progress += packet.direction * packet.speed * dt;
                
                // Reset when reaching end
                if (packet.progress >= 1 || packet.progress <= 0) {
                    packet.direction *= -1;
                    packet.progress = Math.max(0, Math.min(1, packet.progress));
                    
                    // Pause before going back
                    if (Math.random() > 0.5) {
                        packet.active = false;
                        packet.delayTimer = 1 + Math.random() * 3;
                    }
                }
                
                // Get position on curve
                const t = Math.max(0.001, Math.min(0.999, packet.progress));
                const pos = packet.curve.getPointAt(t);
                packet.core.position.copy(pos);
                packet.glow.position.copy(pos);
                
                // Update trail positions
                packet.trailGroup.children.forEach((trail, i) => {
                    const trailProgress = packet.progress - packet.direction * trail.userData.offset;
                    if (trailProgress > 0.001 && trailProgress < 0.999) {
                        const trailPos = packet.curve.getPointAt(trailProgress);
                        trail.position.copy(trailPos);
                        trail.visible = true;
                    } else {
                        trail.visible = false;
                    }
                });
                
                // Pulse effect for the glow
                const pulse = 0.85 + Math.sin(Date.now() * 0.008 + packet.progress * 8) * 0.15;
                packet.core.scale.setScalar(pulse);
                packet.glow.scale.setScalar(pulse * 1.1);
            });
        }
        
        // Initialize packets after arcs are created
        initDataPackets();

        // ============ HOVER ARCS (Pre-computed for smooth performance) ============
        let hoveredRegion = null;
        const hoverArcsGroup = new THREE.Group();
        globeGroup.add(hoverArcsGroup);

        // Pre-compute all arc data at startup
        const precomputedArcs = new Map();
        
        // Get latency color based on delay value
        function getLatencyColor(delay) {
            if (delay < 80) return { hex: '#00DDAA', rgb: 'rgba(0, 221, 170, 1)' }; // Green - low
            if (delay < 150) return { hex: '#FFB432', rgb: 'rgba(255, 180, 50, 1)' }; // Yellow - medium
            return { hex: '#FF5566', rgb: 'rgba(255, 85, 102, 1)' }; // Red - high
        }

        function precomputeArcData(startR, endR) {
            const s = startR.position.clone(), e = endR.position.clone();
            const mid = s.clone().add(e).multiplyScalar(0.5);
            mid.normalize().multiplyScalar(radius + s.distanceTo(e) * 0.45);

            const pts = [];
            for (let i = 0; i <= CONFIG.arcPointsCount; i++) {
                const t = i / CONFIG.arcPointsCount, u = 1 - t;
                pts.push(new THREE.Vector3(
                    u * u * s.x + 2 * u * t * mid.x + t * t * e.x,
                    u * u * s.y + 2 * u * t * mid.y + t * t * e.y,
                    u * u * s.z + 2 * u * t * mid.z + t * t * e.z
                ));
            }

            return { points: pts, startR, endR };
        }

        // Pre-compute all arcs between all region pairs
        regionMarkers.forEach(startR => {
            regionMarkers.forEach(endR => {
                if (startR !== endR) {
                    const key = `${startR.name}->${endR.name}`;
                    precomputedArcs.set(key, precomputeArcData(startR, endR));
                }
            });
        });

        // Active hover arc objects
        let activeHoverArcs = [];

        function activateHoverArcs(sourceRegion) {
            regionMarkers.forEach(targetR => {
                if (targetR !== sourceRegion) {
                    const key = `${sourceRegion.name}->${targetR.name}`;
                    const data = precomputedArcs.get(key);
                    if (data) {
                        const delay = NETWORK_DELAYS[sourceRegion.name][targetR.name];
                        const latencyColor = getLatencyColor(delay);
                        
                        // Create material with latency-based color
                        const mat = new THREE.MeshBasicMaterial({ 
                            color: new THREE.Color(latencyColor.hex),
                            transparent: true, 
                            opacity: 0.9, 
                            depthWrite: false, 
                            blending: THREE.AdditiveBlending 
                        });
                        
                        // Start with minimal tube
                        const initialPts = data.points.slice(0, 2);
                        const initialCurve = new THREE.CatmullRomCurve3(initialPts);
                        const tubeGeo = new THREE.TubeGeometry(initialCurve, 2, CONFIG.arcThickness, 6, false);
                        const arc = new THREE.Mesh(tubeGeo, mat);
                        arc.visible = true;
                        hoverArcsGroup.add(arc);
                        
                        activeHoverArcs.push({ 
                            arc, 
                            mat, 
                            allPoints: data.points, 
                            progress: 0, 
                            delay,
                            lastPointCount: 2
                        });
                    }
                }
            });
        }

        function clearHoverArcs() {
            activeHoverArcs.forEach(a => { 
                hoverArcsGroup.remove(a.arc); 
                a.arc.geometry?.dispose(); 
            });
            activeHoverArcs = [];
        }

        function updateHoverArcs(dt) {
            activeHoverArcs.forEach(a => {
                if (a.progress < 1) {
                    // Smooth easing for animation
                    a.progress = Math.min(1, a.progress + dt * 1.0);
                    const easedProgress = 1 - Math.pow(1 - a.progress, 2); // Ease out quad
                    const cnt = Math.max(2, Math.floor(easedProgress * a.allPoints.length));
                    
                    // Only update geometry if point count changed
                    if (cnt !== a.lastPointCount && cnt >= 2) {
                        a.lastPointCount = cnt;
                        const pts = a.allPoints.slice(0, cnt);
                        const curve = new THREE.CatmullRomCurve3(pts);
                        curve.tension = 0.5;
                        a.arc.geometry?.dispose();
                        a.arc.geometry = new THREE.TubeGeometry(curve, Math.max(4, Math.floor(cnt / 3)), CONFIG.arcThickness, 6, false);
                    }
                }
            });
        }

        // ============ INTERACTION ============
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let isDragging = false, prevMouse = { x: 0, y: 0 };
        let globeRotation = { x: 0, y: 0 };
        const tooltip = document.getElementById('region-tooltip');

        function showTooltip(region, x, y) {
            tooltip.querySelector('.region-name').innerHTML = `<span class="flag">${region.flag}</span> ${region.name}`;
            const delays = NETWORK_DELAYS[region.name];
            const sorted = Object.keys(delays).sort((a, b) => delays[a] - delays[b]);
            tooltip.querySelector('.delay-list').innerHTML = sorted.map(t => {
                const d = delays[t], cls = d < 80 ? 'low' : d < 150 ? 'medium' : 'high';
                const tr = REGIONS.find(rr => rr.name === t);
                return `<div class="delay-item"><span class="target-name"><span class="flag">${tr?.flag || ''}</span> ${t}</span><span class="delay-value ${cls}">${d} ms</span></div>`;
            }).join('');
            tooltip.style.display = 'block';
            tooltip.style.left = (x + 20) + 'px';
            tooltip.style.top = (y - 10) + 'px';
            const rect = tooltip.getBoundingClientRect();
            if (rect.right > window.innerWidth) tooltip.style.left = (x - rect.width - 20) + 'px';
            if (rect.bottom > window.innerHeight) tooltip.style.top = (y - rect.height - 10) + 'px';
        }

        function hideTooltip() { tooltip.style.display = 'none'; }

        globeContainer.addEventListener('mousemove', e => {
            const rect = globeContainer.getBoundingClientRect();
            mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

            if (isDragging) {
                globeRotation.y += (e.clientX - prevMouse.x) * 0.008;
                globeRotation.x += (e.clientY - prevMouse.y) * 0.008;
                globeRotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, globeRotation.x));
                globeGroup.rotation.y = globeRotation.y;
                globeGroup.rotation.x = globeRotation.x;
            } else {
                raycaster.setFromCamera(mouse, camera);
                let closest = null, closestDist = Infinity;

                regionMarkers.forEach(r => {
                    const wp = r.marker.getWorldPosition(new THREE.Vector3());
                    const dist = raycaster.ray.distanceToPoint(wp);
                    const camDist = camera.position.distanceTo(wp);
                    if (dist < 2.2 && camDist < closestDist) {
                        const hits = raycaster.intersectObject(globe);
                        if (hits.length === 0 || hits[0].distance > camDist - 1) {
                            closest = r; closestDist = camDist;
                        }
                    }
                });

                if (closest && closest !== hoveredRegion) {
                    hoveredRegion = closest;
                    clearHoverArcs();
                    activateHoverArcs(hoveredRegion);
                    regionMarkers.forEach(r => {
                        r.marker.scale.setScalar(r === hoveredRegion ? 2 : 1);
                        r.ring.material.opacity = r === hoveredRegion ? 0.6 : 0.35;
                    });
                    showTooltip(hoveredRegion, e.clientX, e.clientY);
                } else if (closest === hoveredRegion && hoveredRegion) {
                    showTooltip(hoveredRegion, e.clientX, e.clientY);
                } else if (!closest && hoveredRegion) {
                    hoveredRegion = null;
                    clearHoverArcs();
                    regionMarkers.forEach(r => { r.marker.scale.setScalar(1); r.ring.material.opacity = 0.35; });
                    hideTooltip();
                }
            }
            prevMouse = { x: e.clientX, y: e.clientY };
        });

        globeContainer.addEventListener('mousedown', e => {
            if (e.button === 0) { isDragging = true; prevMouse = { x: e.clientX, y: e.clientY }; globeContainer.style.cursor = 'grabbing'; hideTooltip(); }
        });

        globeContainer.addEventListener('mouseup', () => { isDragging = false; globeContainer.style.cursor = 'grab'; });
        globeContainer.addEventListener('mouseleave', () => { 
            isDragging = false; 
            globeContainer.style.cursor = 'grab';
            if (hoveredRegion) {
                hoveredRegion = null;
                clearHoverArcs();
                regionMarkers.forEach(r => { r.marker.scale.setScalar(1); r.ring.material.opacity = 0.35; });
                hideTooltip();
            }
        });

        // No wheel zoom - scroll behavior only controlled by page scroll

        window.addEventListener('resize', () => {
            camera.aspect = globeContainer.clientWidth / globeContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(globeContainer.clientWidth, globeContainer.clientHeight);
        });

        // ============ UPDATE LABELS ============
        function updateLabels() {
            const rect = globeContainer.getBoundingClientRect();
            const cameraPos = camera.position.clone();
            
            regionMarkers.forEach(r => {
                const wp = r.marker.getWorldPosition(new THREE.Vector3());
                const vec = wp.clone().project(camera);
                const x = rect.left + (vec.x * 0.5 + 0.5) * rect.width;
                const y = rect.top + (-vec.y * 0.5 + 0.5) * rect.height;

                // Get the globe center (accounting for rotation)
                const globeCenter = globeGroup.position.clone();
                
                // Vector from globe center to marker (this is the "outward normal" of the marker on the sphere)
                const markerNormal = wp.clone().sub(globeCenter).normalize();
                
                // Vector from globe center to camera
                const toCamera = cameraPos.clone().sub(globeCenter).normalize();
                
                // Dot product: positive means marker faces camera, negative means it's on the back
                const facingCamera = markerNormal.dot(toCamera);
                
                // Determine visibility
                const isFrontSide = facingCamera > 0.15; // Front-facing
                const isBackSide = facingCamera < -0.15; // Back-facing
                // else it's on the edge/silhouette

                // Set opacity: 100% for front, 33% for back, fade for edge
                if (isFrontSide) {
                    r.label.style.opacity = '1';
                    r.marker.material.opacity = 0.95;
                    r.ring.material.opacity = 0.25;
                    r.pulse.material.opacity = 0.12;
                    r.baseDot.material.opacity = 0.9;
                    r.pole.material.opacity = 0.4;
                } else if (isBackSide) {
                    r.label.style.opacity = '0.33';
                    r.marker.material.opacity = 0.33;
                    r.ring.material.opacity = 0.08;
                    r.pulse.material.opacity = 0.04;
                    r.baseDot.material.opacity = 0.3;
                    r.pole.material.opacity = 0.13;
                } else {
                    // Edge - transitioning, make semi-transparent
                    const edgeOpacity = (facingCamera + 0.15) / 0.3; // 0 to 1 as it transitions
                    r.label.style.opacity = Math.max(0.1, edgeOpacity).toString();
                    r.marker.material.opacity = 0.33 + edgeOpacity * 0.62;
                    r.ring.material.opacity = 0.08 + edgeOpacity * 0.17;
                    r.pulse.material.opacity = 0.04 + edgeOpacity * 0.08;
                    r.baseDot.material.opacity = 0.3 + edgeOpacity * 0.6;
                    r.pole.material.opacity = 0.13 + edgeOpacity * 0.27;
                }
                
                r.label.style.left = (x + 12) + 'px';
                r.label.style.top = (y - 6) + 'px';

                // Make rings face camera
                r.ring.lookAt(camera.position);
                r.pulse.lookAt(camera.position);
            });
        }

        // ============ ANIMATION ============
        let lastTime = 0;
        function animate(time) {
            requestAnimationFrame(animate);
            const dt = (time - lastTime) / 1000;
            lastTime = time;

            // Smooth zoom
            camera.position.z += (targetZoom - camera.position.z) * 0.08;

            if (!isDragging) {
                globeRotation.y += CONFIG.rotationSpeed;
                globeGroup.rotation.y = globeRotation.y;
            }

            atmosphereMaterial.uniforms.time.value = time / 1000;

            regionMarkers.forEach((r, i) => {
                const pulse = Math.sin(time / 1000 * 2 + i * 0.5) * 0.25 + 1;
                r.pulse.scale.setScalar(pulse);
                r.pulse.material.opacity = 0.12 * (2 - pulse);
            });

            if (activeHoverArcs.length > 0) updateHoverArcs(dt);
            updateDataPackets(dt);
            updateLabels();

            renderer.render(scene, camera);
        }
        animate(0);

        // ============ STATUS PAGE GENERATION ============
        
        // Update last updated time
        function updateTimestamp() {
            const now = new Date();
            const timeStr = now.toISOString().replace('T', ' ').slice(0, 19) + ' UTC';
            document.getElementById('last-update-time').textContent = timeStr;
        }
        updateTimestamp();
        setInterval(updateTimestamp, 60000);

        // Region data with status - detailed incident/maintenance info
        const REGION_STATUS_DATA = [
            { 
                name: 'Dallas', code: 'DAL1', flag: 'ðŸ‡ºðŸ‡¸', status: 'operational', uptime: 99.99, 
                lastIncident: 'Nov 28, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'New York', code: 'NYC1', flag: 'ðŸ‡ºðŸ‡¸', status: 'degraded', uptime: 99.85,
                lastIncident: 'Dec 20, 2025',
                activeIncidents: [{
                    id: 1,
                    title: 'Increased API Response Times',
                    description: 'Some users are experiencing slower API response times in the NYC1 region.',
                    status: 'investigating',
                    severity: 'major',
                    startedAt: 'Dec 20, 2025 14:30 UTC',
                    updates: [
                        { status: 'investigating', time: 'Dec 20, 2025 14:45 UTC', message: 'We are investigating reports of increased latency.' },
                        { status: 'investigating', time: 'Dec 20, 2025 14:30 UTC', message: 'We are aware of degraded performance and are looking into it.' }
                    ]
                }],
                scheduledMaintenance: []
            },
            { 
                name: 'Los Angeles', code: 'LAX1', flag: 'ðŸ‡ºðŸ‡¸', status: 'operational', uptime: 99.99,
                lastIncident: 'Dec 5, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'Miami', code: 'MIA1', flag: 'ðŸ‡ºðŸ‡¸', status: 'operational', uptime: 99.97,
                lastIncident: 'Dec 1, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'Las Vegas', code: 'LAS1', flag: 'ðŸ‡ºðŸ‡¸', status: 'maintenance', uptime: 99.99,
                lastIncident: 'Nov 15, 2025',
                activeIncidents: [],
                scheduledMaintenance: [{
                    id: 1,
                    title: 'Network Infrastructure Upgrade',
                    description: 'Scheduled maintenance to upgrade network infrastructure for improved performance.',
                    status: 'in_progress',
                    scheduledStart: 'Dec 21, 2025 02:00 UTC',
                    scheduledEnd: 'Dec 21, 2025 06:00 UTC',
                    impact: 'Brief connectivity interruptions possible'
                }]
            },
            { 
                name: 'Utah', code: 'SLC1', flag: 'ðŸ‡ºðŸ‡¸', status: 'operational', uptime: 99.98,
                lastIncident: 'Nov 20, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'London', code: 'LON1', flag: 'ðŸ‡¬ðŸ‡§', status: 'operational', uptime: 99.99,
                lastIncident: 'Dec 10, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'Frankfurt', code: 'FRA1', flag: 'ðŸ‡©ðŸ‡ª', status: 'operational', uptime: 99.98,
                lastIncident: 'Dec 8, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'Amsterdam', code: 'AMS1', flag: 'ðŸ‡³ðŸ‡±', status: 'operational', uptime: 99.99,
                lastIncident: 'Nov 25, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'Bern', code: 'BRN1', flag: 'ðŸ‡¨ðŸ‡­', status: 'outage', uptime: 98.50,
                lastIncident: 'Dec 18, 2025',
                activeIncidents: [{
                    id: 1,
                    title: 'Complete Service Outage',
                    description: 'All services in Bern region are currently unavailable. Network connectivity issue affecting the entire datacenter.',
                    status: 'investigating',
                    severity: 'critical',
                    startedAt: 'Dec 18, 2025 16:00 UTC',
                    updates: [
                        { status: 'investigating', time: 'Dec 18, 2025 16:30 UTC', message: 'Our datacenter partner is investigating a network infrastructure failure. Updates will be provided every 15 minutes.' },
                        { status: 'investigating', time: 'Dec 18, 2025 16:00 UTC', message: 'We are aware of a complete service outage in the Bern region and are investigating urgently.' }
                    ]
                }],
                scheduledMaintenance: []
            },
            { 
                name: 'Dubai', code: 'DXB1', flag: 'ðŸ‡¦ðŸ‡ª', status: 'operational', uptime: 99.96,
                lastIncident: 'Dec 12, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            },
            { 
                name: 'Singapore', code: 'SIN1', flag: 'ðŸ‡¸ðŸ‡¬', status: 'operational', uptime: 99.98,
                lastIncident: 'Dec 15, 2025',
                activeIncidents: [],
                scheduledMaintenance: []
            }
        ];

        // Generate 30-day uptime data
        function generateUptimeDays() {
            const days = [];
            for (let i = 0; i < 30; i++) {
                const rand = Math.random();
                if (rand > 0.98) days.push('degraded');
                else if (rand > 0.995) days.push('outage');
                else days.push('operational');
            }
            return days;
        }

        // SVG icons for status
        const STATUS_ICONS = {
            operational: '<svg class="icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>',
            degraded: '<svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',
            outage: '<svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',
            maintenance: '<svg class="icon" viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>',
            unknown: '<svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>'
        };

        const INCIDENT_ICON = '<svg class="badge-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>';
        const MAINTENANCE_ICON = '<svg class="badge-icon" viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>';

        // Render region cards
        function renderRegionCards() {
            const grid = document.getElementById('region-grid');
            grid.innerHTML = REGION_STATUS_DATA.map((region, index) => {
                const uptimeDays = generateUptimeDays();
                const statusLabels = {
                    operational: 'Operational',
                    degraded: 'Degraded',
                    outage: 'Major Outage',
                    maintenance: 'Maintenance',
                    unknown: 'Unknown'
                };
                
                const hasIncidents = region.activeIncidents && region.activeIncidents.length > 0;
                const hasMaintenance = region.scheduledMaintenance && region.scheduledMaintenance.length > 0;
                
                // Build incident/maintenance badges
                let badges = '';
                if (hasIncidents) {
                    badges += `<span class="incident-badge incident">${INCIDENT_ICON}${region.activeIncidents.length} Incident${region.activeIncidents.length > 1 ? 's' : ''}</span>`;
                }
                if (hasMaintenance) {
                    badges += `<span class="incident-badge maintenance">${MAINTENANCE_ICON}Maintenance</span>`;
                }
                
                return `
                    <div class="region-card" onclick="openRegionPanel(${index})">
                        <div class="region-card-header">
                            <div class="region-info">
                                <h3>${region.flag} ${region.name} <span class="region-code">${region.code}</span>${badges}</h3>
                            </div>
                            <span class="status-pill ${region.status}">
                                ${STATUS_ICONS[region.status] || '<span class="dot"></span>'}
                                ${statusLabels[region.status]}
                            </span>
                        </div>
                        <div class="region-meta">
                            <span>30-day uptime: ${region.uptime}%</span>
                            <span>${!hasIncidents && !hasMaintenance ? 'No active issues' : ''}</span>
                        </div>
                        <div class="uptime-bar">
                            ${uptimeDays.map(d => `<div class="uptime-day ${d === 'operational' ? '' : d}"></div>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }
        renderRegionCards();

        // Update globe labels with status indicators
        function updateGlobeStatusIndicators() {
            const warningIcon = '<svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>';
            const maintenanceIcon = '<svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>';
            
            regionMarkers.forEach(marker => {
                const regionData = REGION_STATUS_DATA.find(r => r.name === marker.name);
                if (regionData && marker.label) {
                    let statusHtml = '';
                    let statusColor = null;
                    
                    if (regionData.status === 'outage') {
                        statusHtml = `<span class="status-indicator outage">${warningIcon}</span>`;
                        statusColor = 0xFF5566; // Red
                    } else if (regionData.status === 'degraded') {
                        statusHtml = `<span class="status-indicator degraded">${warningIcon}</span>`;
                        statusColor = 0xFFB432; // Yellow/Orange
                    } else if (regionData.status === 'maintenance') {
                        statusHtml = `<span class="status-indicator maintenance">${maintenanceIcon}</span>`;
                        statusColor = 0x3B82F6; // Blue
                    }
                    
                    marker.label.innerHTML = `<span class="flag">${marker.flag}</span> ${marker.name}${statusHtml}`;
                    
                    // Update marker color based on status
                    if (statusColor && marker.markerMat) {
                        marker.markerMat.color.setHex(statusColor);
                        if (marker.ringMat) marker.ringMat.color.setHex(statusColor);
                        if (marker.pulseMat) marker.pulseMat.color.setHex(statusColor);
                    }
                }
            });
        }
        
        // Call after a short delay to ensure everything is initialized
        setTimeout(updateGlobeStatusIndicators, 200);

        // ============ REGION PANEL FUNCTIONS ============
        let currentRegionIndex = null;
        let currentTab = 'overview';

        function openRegionPanel(index) {
            currentRegionIndex = index;
            const region = REGION_STATUS_DATA[index];
            
            document.getElementById('panel-region-name').textContent = `${region.flag} ${region.name}`;
            document.getElementById('panel-region-code').textContent = region.code;
            
            const statusLabels = {
                operational: 'Operational',
                degraded: 'Degraded Performance',
                outage: 'Major Outage',
                maintenance: 'Maintenance',
                unknown: 'Unknown'
            };
            
            document.getElementById('panel-status-badge').innerHTML = `
                <span class="status-pill ${region.status}">
                    ${STATUS_ICONS[region.status] || '<span class="dot"></span>'}
                    ${statusLabels[region.status]}
                </span>
            `;
            
            switchTab('overview');
            
            document.getElementById('region-panel-overlay').classList.add('active');
            document.getElementById('region-panel').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeRegionPanel() {
            document.getElementById('region-panel-overlay').classList.remove('active');
            document.getElementById('region-panel').classList.remove('active');
            document.body.style.overflow = '';
            currentRegionIndex = null;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            renderPanelContent();
        }

        function renderPanelContent() {
            if (currentRegionIndex === null) return;
            const region = REGION_STATUS_DATA[currentRegionIndex];
            const content = document.getElementById('panel-content');
            
            switch (currentTab) {
                case 'overview':
                    content.innerHTML = renderOverviewTab(region);
                    break;
                case 'incidents':
                    content.innerHTML = renderIncidentsTab(region);
                    break;
                case 'maintenance':
                    content.innerHTML = renderMaintenanceTab(region);
                    break;
                case 'latency':
                    content.innerHTML = renderLatencyTab(region);
                    break;
            }
        }

        function renderOverviewTab(region) {
            const hasIssues = region.status !== 'operational';
            const hasIncidents = region.activeIncidents && region.activeIncidents.length > 0;
            
            let alertHtml = '';
            if (hasIssues && hasIncidents) {
                alertHtml = `<div class="panel-alert warning">There are currently issues affecting services in ${region.name} (${region.code}). See incidents tab for details.</div>`;
            } else if (region.status === 'maintenance') {
                alertHtml = `<div class="panel-alert info" style="background: var(--state-information-lighter); color: var(--state-information-dark); border-color: var(--state-information-light);">Scheduled maintenance is in progress. See maintenance tab for details.</div>`;
            } else {
                alertHtml = `<div class="panel-alert info">All services in ${region.name} (${region.code}) are operating normally.</div>`;
            }
            
            let incidentPreview = '';
            if (hasIncidents) {
                const incident = region.activeIncidents[0];
                incidentPreview = `
                    <div class="panel-section">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--text-strong); margin-bottom: 12px;">Active Incidents</h4>
                        <div class="incident-card">
                            <div class="incident-header">
                                <span class="incident-status-badge ${incident.status}">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2z"/></svg>
                                    ${incident.status.charAt(0).toUpperCase() + incident.status.slice(1)}
                                </span>
                                <span class="severity-badge ${incident.severity}">${incident.severity.charAt(0).toUpperCase() + incident.severity.slice(1)}</span>
                            </div>
                            <div class="incident-title">${incident.title}</div>
                            <div class="incident-description">${incident.description}</div>
                            <div class="incident-meta">
                                Started: ${incident.startedAt} â€¢ <span class="ongoing">Ongoing</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return `
                ${alertHtml}
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">30-Day Uptime</div>
                        <div class="stat-value ${region.uptime > 99.9 ? 'success' : ''}">${region.uptime}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Incident</div>
                        <div class="stat-value" style="font-size: 16px;">${region.lastIncident || 'No incidents'}</div>
                    </div>
                </div>
                ${incidentPreview}
            `;
        }

        function renderIncidentsTab(region) {
            const hasIncidents = region.activeIncidents && region.activeIncidents.length > 0;
            
            if (!hasIncidents) {
                return `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
                        <div class="empty-state-text">No incidents reported for this region in the last 30 days.</div>
                    </div>
                `;
            }
            
            return region.activeIncidents.map(incident => `
                <div class="incident-card">
                    <div class="incident-header">
                        <span class="incident-status-badge ${incident.status}">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2z"/></svg>
                            ${incident.status.charAt(0).toUpperCase() + incident.status.slice(1)}
                        </span>
                        <span class="severity-badge ${incident.severity}">${incident.severity.charAt(0).toUpperCase() + incident.severity.slice(1)}</span>
                    </div>
                    <div class="incident-title">${incident.title}</div>
                    <div class="incident-description">${incident.description}</div>
                    <div class="incident-meta">
                        Started: ${incident.startedAt} â€¢ <span class="ongoing">Ongoing</span>
                    </div>
                    
                    <div class="status-updates">
                        <div class="status-updates-title">Status Updates</div>
                        ${incident.updates.map(update => `
                            <div class="update-item">
                                <div class="update-dot ${update.status}"></div>
                                <div class="update-content">
                                    <div class="update-header">
                                        <span class="update-status">${update.status.charAt(0).toUpperCase() + update.status.slice(1)}</span>
                                        <span class="update-time">${update.time}</span>
                                    </div>
                                    <div class="update-message">${update.message}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderMaintenanceTab(region) {
            const hasMaintenance = region.scheduledMaintenance && region.scheduledMaintenance.length > 0;
            
            if (!hasMaintenance) {
                return `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                        <div class="empty-state-text">No scheduled maintenance for this region.</div>
                    </div>
                `;
            }
            
            return region.scheduledMaintenance.map(maint => `
                <div class="incident-card">
                    <div class="incident-header">
                        <span class="incident-status-badge" style="background: var(--state-information-lighter); color: var(--state-information-base);">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
                            ${maint.status === 'in_progress' ? 'In Progress' : 'Scheduled'}
                        </span>
                    </div>
                    <div class="incident-title">${maint.title}</div>
                    <div class="incident-description">${maint.description}</div>
                    <div class="incident-meta" style="flex-direction: column; gap: 4px; align-items: flex-start;">
                        <span>Scheduled: ${maint.scheduledStart} - ${maint.scheduledEnd}</span>
                        <span>Impact: ${maint.impact}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderLatencyTab(region) {
            const delays = NETWORK_DELAYS[region.name];
            if (!delays) {
                return `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <div class="empty-state-text">Latency data unavailable for this region.</div>
                    </div>
                `;
            }
            
            return `
                <div class="panel-section">
                    <h4 style="font-size: 14px; font-weight: 600; color: var(--text-strong); margin-bottom: 16px;">Latency from ${region.name} to other regions</h4>
                    <table class="panel-latency-table">
                        <thead>
                            <tr>
                                <th>Destination</th>
                                <th>Avg Latency</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.keys(delays).map(dest => {
                                const latency = delays[dest];
                                const statusClass = latency < 80 ? 'low' : latency < 150 ? 'medium' : 'high';
                                const statusText = latency < 80 ? 'Normal' : latency < 150 ? 'Elevated' : 'High';
                                const targetRegion = REGIONS.find(r => r.name === dest);
                                return `
                                    <tr>
                                        <td>${targetRegion?.flag || ''} ${dest}</td>
                                        <td><span class="latency-value ${statusClass}">${latency} ms</span></td>
                                        <td><span class="status-pill ${statusClass === 'low' ? 'operational' : statusClass === 'medium' ? 'degraded' : 'outage'}" style="font-size: 11px;">${statusText}</span></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Close panel with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeRegionPanel();
        });

        // Render latency table (from Dallas)
        function renderLatencyTable() {
            const tbody = document.querySelector('#latency-table tbody');
            const dallasDelays = NETWORK_DELAYS['Dallas'];
            
            tbody.innerHTML = Object.keys(dallasDelays).map(dest => {
                const latency = dallasDelays[dest];
                const p95 = Math.round(latency * 1.15);
                let statusClass, statusText;
                
                if (latency < 80) {
                    statusClass = 'low';
                    statusText = 'Normal';
                } else if (latency < 150) {
                    statusClass = 'medium';
                    statusText = 'Elevated';
                } else {
                    statusClass = 'high';
                    statusText = 'High';
                }
                
                const regionData = REGIONS.find(r => r.name === dest);
                const flag = regionData?.flag || '';
                
                return `
                    <tr>
                        <td>${flag} ${dest}</td>
                        <td><span class="latency-value ${statusClass}">${latency} ms</span></td>
                        <td><span class="latency-value ${statusClass}">${p95} ms</span></td>
                        <td><span class="status-pill ${statusClass === 'low' ? 'operational' : statusClass === 'medium' ? 'degraded' : 'outage'}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');
        }
        renderLatencyTable();
    </script>
</body>
</html>
